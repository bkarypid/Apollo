---
- hosts: all:!role=bastion
  gather_facts: False
  tasks:
    - name: Wait for port 22 to become available from local server.
      local_action: "wait_for port={{ ansible_ssh_port }} host={{ ansible_ssh_host }} delay=10 timeout=90"
      sudo: False
      when: bastion_ip is not defined

  roles:
    - docker
    - weave
    - consul
    - registrator
    - haproxy
